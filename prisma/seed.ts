import { PrismaClient, UserRole, BookingStatus } from '@prisma/client';
import bcrypt from 'bcryptjs';

const prisma = new PrismaClient();

async function main() {
  console.log('üå± Starting database seeding...');

  // Clean existing data (be careful in production!)
  await prisma.booking.deleteMany();
  await prisma.service.deleteMany();
  await prisma.serviceCategory.deleteMany();
  await prisma.professional.deleteMany();
  await prisma.user.deleteMany();

  // Create service categories
  const categories = await Promise.all([
    prisma.serviceCategory.create({
      data: {
        name: 'Hogar',
        description: 'Servicios para el hogar y reparaciones dom√©sticas',
        icon: 'home',
        slug: 'hogar',
      },
    }),
    prisma.serviceCategory.create({
      data: {
        name: 'Tecnolog√≠a',
        description: 'Desarrollo web, aplicaciones y servicios IT',
        icon: 'laptop',
        slug: 'tecnologia',
      },
    }),
    prisma.serviceCategory.create({
      data: {
        name: 'Fotograf√≠a',
        description: 'Fotograf√≠a profesional para eventos y retratos',
        icon: 'camera',
        slug: 'fotografia',
      },
    }),
    prisma.serviceCategory.create({
      data: {
        name: 'Automotriz',
        description: 'Reparaci√≥n y mantenimiento de veh√≠culos',
        icon: 'car',
        slug: 'automotriz',
      },
    }),
  ]);

  console.log('‚úÖ Created service categories');

  // Create users (clients and professionals)
  const hashedPassword = await bcrypt.hash('password123', 10);

  // Create client users
  const clients = await Promise.all([
    prisma.user.create({
      data: {
        email: 'ana.garcia@email.com',
        name: 'Ana Garc√≠a',
        password: hashedPassword,
        role: UserRole.CLIENT,
        isEmailVerified: true,
        avatar: '/avatars/ana.jpg',
      },
    }),
    prisma.user.create({
      data: {
        email: 'roberto.silva@email.com',
        name: 'Roberto Silva',
        password: hashedPassword,
        role: UserRole.CLIENT,
        isEmailVerified: true,
        avatar: '/avatars/roberto.jpg',
      },
    }),
    prisma.user.create({
      data: {
        email: 'maria.lopez@email.com',
        name: 'Mar√≠a L√≥pez',
        password: hashedPassword,
        role: UserRole.CLIENT,
        isEmailVerified: true,
        avatar: '/avatars/maria.jpg',
      },
    }),
  ]);

  console.log('‚úÖ Created client users');

  // Create professional users
  const professionalUsers = await Promise.all([
    prisma.user.create({
      data: {
        email: 'carlos.mendez@email.com',
        name: 'Carlos M√©ndez',
        password: hashedPassword,
        role: UserRole.PROFESSIONAL,
        isEmailVerified: true,
        avatar: '/avatars/carlos.jpg',
      },
    }),
    prisma.user.create({
      data: {
        email: 'laura.jimenez@email.com',
        name: 'Laura Jim√©nez',
        password: hashedPassword,
        role: UserRole.PROFESSIONAL,
        isEmailVerified: true,
        avatar: '/avatars/laura.jpg',
      },
    }),
    prisma.user.create({
      data: {
        email: 'miguel.torres@email.com',
        name: 'Miguel Torres',
        password: hashedPassword,
        role: UserRole.PROFESSIONAL,
        isEmailVerified: true,
        avatar: '/avatars/miguel.jpg',
      },
    }),
    prisma.user.create({
      data: {
        email: 'jorge.ramirez@email.com',
        name: 'Jorge Ram√≠rez',
        password: hashedPassword,
        role: UserRole.PROFESSIONAL,
        isEmailVerified: true,
        avatar: '/avatars/jorge.jpg',
      },
    }),
  ]);

  console.log('‚úÖ Created professional users');

  // Create professional profiles
  const professionals = await Promise.all([
    prisma.professional.create({
      data: {
        userId: professionalUsers[0].id,
        bio: 'T√©cnico especializado en reparaci√≥n de electrodom√©sticos con m√°s de 10 a√±os de experiencia. Servicio a domicilio con garant√≠a.',
        experience: 10,
        rating: 4.8,
        reviewCount: 124,
        isVerified: true,
        specialties: ['Electrodom√©sticos', 'Reparaci√≥n', 'Mantenimiento'],
        hourlyRate: 50000,
        address: 'Calle 85 #15-20',
        city: 'Bogot√°',
        state: 'Cundinamarca',
        country: 'Colombia',
      },
    }),
    prisma.professional.create({
      data: {
        userId: professionalUsers[1].id,
        bio: 'Fot√≥grafa profesional especializada en eventos, bodas y retratos. Equipo profesional de √∫ltima generaci√≥n.',
        experience: 7,
        rating: 4.9,
        reviewCount: 78,
        isVerified: true,
        specialties: ['Fotograf√≠a de eventos', 'Bodas', 'Retratos'],
        hourlyRate: 200000,
        address: 'Carrera 11 #93-45',
        city: 'Barranquilla',
        state: 'Atl√°ntico',
        country: 'Colombia',
      },
    }),
    prisma.professional.create({
      data: {
        userId: professionalUsers[2].id,
        bio: 'Plomero certificado con experiencia en instalaciones residenciales y comerciales. Servicio 24/7 para emergencias.',
        experience: 8,
        rating: 4.7,
        reviewCount: 156,
        isVerified: true,
        specialties: ['Plomer√≠a', 'Instalaciones', 'Emergencias'],
        hourlyRate: 40000,
        address: 'Avenida 6N #23-50',
        city: 'Cali',
        state: 'Valle del Cauca',
        country: 'Colombia',
      },
    }),
    prisma.professional.create({
      data: {
        userId: professionalUsers[3].id,
        bio: 'Mec√°nico automotriz con certificaciones internacionales. Especialista en diagn√≥stico computarizado y reparaciones.',
        experience: 12,
        rating: 4.8,
        reviewCount: 134,
        isVerified: true,
        specialties: ['Mec√°nica automotriz', 'Diagn√≥stico', 'Mantenimiento'],
        hourlyRate: 80000,
        address: 'Carrera 70 #52-15',
        city: 'Medell√≠n',
        state: 'Antioquia',
        country: 'Colombia',
      },
    }),
  ]);

  console.log('‚úÖ Created professional profiles');

  // Create services
  const services = await Promise.all([
    prisma.service.create({
      data: {
        title: 'Reparaci√≥n de Electrodom√©sticos',
        description: 'Reparaci√≥n profesional de lavadoras, neveras, estufas y m√°s. Servicio a domicilio con garant√≠a de 6 meses.',
        categoryId: categories[0].id, // Hogar
        professionalId: professionals[0].id,
        price: 50000,
        duration: 120,
        tags: ['Reparaci√≥n', 'A domicilio', 'Garant√≠a', 'Electrodom√©sticos'],
        images: ['/services/electrodomesticos1.jpg', '/services/electrodomesticos2.jpg'],
      },
    }),
    prisma.service.create({
      data: {
        title: 'Desarrollo Web Profesional',
        description: 'Creaci√≥n de sitios web modernos y aplicaciones web usando React, Next.js y Node.js. Dise√±o responsive y optimizado.',
        categoryId: categories[1].id, // Tecnolog√≠a
        professionalId: professionals[0].id,
        price: 800000,
        duration: 480,
        tags: ['React', 'Next.js', 'Responsive', 'Web Development'],
        images: ['/services/web-dev1.jpg', '/services/web-dev2.jpg'],
      },
    }),
    prisma.service.create({
      data: {
        title: 'Fotograf√≠a de Eventos',
        description: 'Fotograf√≠a profesional para bodas, cumplea√±os, eventos corporativos y sociales. Edici√≥n incluida.',
        categoryId: categories[2].id, // Fotograf√≠a
        professionalId: professionals[1].id,
        price: 200000,
        duration: 240,
        tags: ['Bodas', 'Eventos', 'Corporativo', 'Edici√≥n'],
        images: ['/services/fotografia1.jpg', '/services/fotografia2.jpg'],
      },
    }),
    prisma.service.create({
      data: {
        title: 'Plomer√≠a Residencial',
        description: 'Instalaci√≥n y reparaci√≥n de tuber√≠as, grifos, sanitarios. Servicio 24/7 para emergencias.',
        categoryId: categories[0].id, // Hogar
        professionalId: professionals[2].id,
        price: 40000,
        duration: 90,
        tags: ['24/7', 'Emergencias', 'Garant√≠a', 'Instalaci√≥n'],
        images: ['/services/plomeria1.jpg', '/services/plomeria2.jpg'],
      },
    }),
    prisma.service.create({
      data: {
        title: 'Mec√°nica Automotriz',
        description: 'Reparaci√≥n y mantenimiento de veh√≠culos. Diagn√≥stico computarizado incluido. Repuestos originales.',
        categoryId: categories[3].id, // Automotriz
        professionalId: professionals[3].id,
        price: 80000,
        duration: 180,
        tags: ['Diagn√≥stico', 'Mantenimiento', 'Garant√≠a', 'Repuestos'],
        images: ['/services/mecanica1.jpg', '/services/mecanica2.jpg'],
      },
    }),
  ]);

  console.log('‚úÖ Created services');

  // Create some bookings
  const bookings = await Promise.all([
    prisma.booking.create({
      data: {
        clientId: clients[0].id,
        professionalId: professionals[0].id,
        serviceId: services[0].id,
        status: BookingStatus.CONFIRMED,
        scheduledAt: new Date('2025-06-02T14:00:00'),
        duration: 120,
        totalPrice: 50000,
        notes: 'Reparaci√≥n de lavadora que no est√° centrifugando correctamente.',
      },
    }),
    prisma.booking.create({
      data: {
        clientId: clients[1].id,
        professionalId: professionals[1].id,
        serviceId: services[2].id,
        status: BookingStatus.PENDING,
        scheduledAt: new Date('2025-06-05T10:00:00'),
        duration: 240,
        totalPrice: 200000,
        notes: 'Fotograf√≠a para evento de cumplea√±os, aproximadamente 50 personas.',
      },
    }),
    prisma.booking.create({
      data: {
        clientId: clients[2].id,
        professionalId: professionals[2].id,
        serviceId: services[3].id,
        status: BookingStatus.COMPLETED,
        scheduledAt: new Date('2025-05-30T09:00:00'),
        duration: 90,
        totalPrice: 40000,
        notes: 'Reparaci√≥n de grifo de cocina.',
        completedAt: new Date('2025-05-30T10:30:00'),
      },
    }),
  ]);

  console.log('‚úÖ Created bookings');

  console.log('üéâ Database seeding completed successfully!');
  console.log(`
üìä Summary:
- ${categories.length} service categories
- ${clients.length} client users  
- ${professionalUsers.length} professional users
- ${professionals.length} professional profiles
- ${services.length} services
- ${bookings.length} bookings
  `);
}

main()
  .then(async () => {
    await prisma.$disconnect();
  })
  .catch(async (e) => {
    console.error(e);
    await prisma.$disconnect();
    process.exit(1);
  });
